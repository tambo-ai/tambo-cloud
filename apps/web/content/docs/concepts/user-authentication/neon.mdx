---
title: Neon
description: Learn how to integrate Tambo with Auth.js using Neon as the database backend.
---

This guide shows how to integrate Tambo with Auth.js using Neon as the database backend for session storage.

<Callout type="info" title="Prerequisites">
  This assumes you have already installed and configured Auth.js with Neon as
  the database adapter. If you haven't, follow the [Neon Auth.js
  guide](https://neon.tech/docs/guides/auth-authjs) to set up Auth.js with Neon
  authentication first.
</Callout>

<Callout type="info" title="Required API Routes">
  These docs assume you have already set up the Auth.js API routes at
  `/api/auth/[...nextauth]/route.ts` with Neon as the database adapter.
</Callout>

## Required Packages

```bash
npm install next-auth @auth/neon-adapter
npm install @neondatabase/serverless
npm install @tambo-ai/react
```

## Server-Side Token Retrieval

Create a server component to retrieve the user's session token:

```tsx title="app/layout.tsx"
import { getServerSession } from "next-auth/next";
import { authOptions } from "./api/auth/[...nextauth]/route";
import ClientLayout from "./client-layout";

export default async function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const session = await getServerSession(authOptions);

  return (
    <html lang="en">
      <body>
        <ClientLayout userToken={session?.accessToken}>{children}</ClientLayout>
      </body>
    </html>
  );
}
```

## Client-Side Integration

Create a client component to wrap your app with TamboProvider:

```tsx title="app/client-layout.tsx"
"use client";

import { TamboProvider } from "@tambo-ai/react";
import { ReactNode } from "react";

interface ClientLayoutProps {
  children: ReactNode;
  userToken?: string;
}

export default function ClientLayout({
  children,
  userToken,
}: ClientLayoutProps) {
  // TamboProvider must be in a client component to handle token state
  return <TamboProvider userToken={userToken}>{children}</TamboProvider>;
}
```

## Alternative: Client-Side Token Retrieval

If you prefer to handle token retrieval on the client side, you can use Auth.js's session hook:

```tsx title="app/client-layout-alternative.tsx"
"use client";

import { useSession } from "next-auth/react";
import { TamboProvider } from "@tambo-ai/react";
import { ReactNode } from "react";

interface ClientLayoutProps {
  children: ReactNode;
}

export default function ClientLayout({ children }: ClientLayoutProps) {
  const { data: session } = useSession();

  // TamboProvider must be in a client component to handle token state
  return (
    <TamboProvider userToken={session?.accessToken}>{children}</TamboProvider>
  );
}
```

For the client-side approach, you'll need to wrap your app with Auth.js's SessionProvider:

```tsx title="app/root-layout.tsx"
"use client";

import { SessionProvider } from "next-auth/react";
import ClientLayout from "./client-layout-alternative";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  // SessionProvider needed for Auth.js client-side hooks
  return (
    <html lang="en">
      <body>
        <SessionProvider>
          <ClientLayout>{children}</ClientLayout>
        </SessionProvider>
      </body>
    </html>
  );
}
```

## Auth.js Configuration with Neon

Your Auth.js configuration should use the Neon adapter to store session and user data:

```tsx title="app/api/auth/[...nextauth]/route.ts"
import NextAuth from "next-auth";
import { NeonAdapter } from "@auth/neon-adapter";
import { neon } from "@neondatabase/serverless";
import GoogleProvider from "next-auth/providers/google";

const sql = neon(process.env.NEON_DATABASE_URL!);

export const authOptions = {
  adapter: NeonAdapter(sql),
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
  ],
  callbacks: {
    async jwt({ token, account }) {
      if (account) {
        token.accessToken = account.access_token;
      }
      return token;
    },
    async session({ session, token }) {
      session.accessToken = token.accessToken as string;
      return session;
    },
  },
};

const handler = NextAuth(authOptions);
export { handler as GET, handler as POST };
```

## Usage in Components

Now you can use Tambo components in your authenticated pages:

```tsx title="app/dashboard/page.tsx"
import { MessageThreadFull } from "@components/ui/tambo";

export default function Dashboard() {
  return (
    <div>
      <h1>Dashboard</h1>
      <MessageThreadFull />
    </div>
  );
}
```
