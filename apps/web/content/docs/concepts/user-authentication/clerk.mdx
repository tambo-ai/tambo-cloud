---
title: Clerk
description: Learn how to integrate Tambo with Clerk for user authentication.
---

This guide shows how to integrate Tambo with Clerk in a Next.js application.

<Callout type="info" title="Prerequisites">
  This assumes you have already installed and configured Clerk in your Next.js
  application. If you haven't, follow the [Clerk Next.js Quick Start
  guide](https://clerk.com/docs/quickstarts/nextjs) to set up Clerk
  authentication first.
</Callout>

<Callout type="info" title="Required Setup">
  These docs assume you have already set up Clerk's middleware and
  sign-in/sign-up pages. Clerk handles authentication through middleware and
  doesn't require specific API routes.
</Callout>

## Required Packages

```bash
npm install @clerk/nextjs
npm install @tambo-ai/react
```

## Server-Side Token Retrieval

Create a server component to retrieve the user's session token:

```tsx title="app/layout.tsx"
import { auth } from "@clerk/nextjs/server";
import ClientLayout from "./client-layout";

export default async function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const { getToken } = await auth();

  // Get the session token from Clerk
  const token = await getToken();

  return (
    <html lang="en">
      <body>
        <ClientLayout userToken={token}>{children}</ClientLayout>
      </body>
    </html>
  );
}
```

## Client-Side Integration

Create a client component to wrap your app with both Clerk's ClerkProvider and TamboProvider:

```tsx title="app/client-layout.tsx"
"use client";

import { ClerkProvider } from "@clerk/nextjs";
import { TamboProvider } from "@tambo-ai/react";
import { ReactNode } from "react";

interface ClientLayoutProps {
  children: ReactNode;
  userToken?: string;
}

export default function ClientLayout({
  children,
  userToken,
}: ClientLayoutProps) {
  // ClerkProvider needed for Clerk client-side hooks
  // TamboProvider must be in a client component to handle token state
  return (
    <ClerkProvider>
      <TamboProvider userToken={userToken}>{children}</TamboProvider>
    </ClerkProvider>
  );
}
```

## Alternative: Client-Side Token Retrieval

If you prefer to handle token retrieval on the client side, you can use Clerk's `useAuth` hook:

```tsx title="app/client-layout-alternative.tsx"
"use client";

import { ClerkProvider, useAuth } from "@clerk/nextjs";
import { TamboProvider } from "@tambo-ai/react";
import { ReactNode, useEffect, useState } from "react";

interface ClientLayoutProps {
  children: ReactNode;
}

function TamboWrapper({ children }: { children: ReactNode }) {
  const { getToken, isLoaded, isSignedIn } = useAuth();
  const [accessToken, setAccessToken] = useState<string | undefined>();

  useEffect(() => {
    async function fetchToken() {
      if (isLoaded && isSignedIn) {
        try {
          const token = await getToken();
          setAccessToken(token || undefined);
        } catch (error) {
          console.error("Error fetching token:", error);
        }
      }
    }

    fetchToken();
  }, [isLoaded, isSignedIn, getToken]);

  // TamboProvider must be in a client component to handle token state
  return <TamboProvider userToken={accessToken}>{children}</TamboProvider>;
}

export default function ClientLayout({ children }: ClientLayoutProps) {
  // ClerkProvider needed for Clerk client-side hooks
  return (
    <ClerkProvider>
      <TamboWrapper>{children}</TamboWrapper>
    </ClerkProvider>
  );
}
```

## Usage in Components

Now you can use Tambo components in your authenticated pages:

```tsx title="app/dashboard/page.tsx"
import { MessageThreadFull } from "@components/ui/tambo";

export default function Dashboard() {
  return (
    <div>
      <h1>Dashboard</h1>
      <MessageThreadFull />
    </div>
  );
}
```

## Custom JWT Template

For advanced use cases, you can create a custom JWT template in Clerk to include specific claims:

1. Go to your Clerk Dashboard
2. Navigate to "JWT Templates"
3. Create a new template with the claims you need
4. Use the template name when calling `getToken()`:

```tsx
const token = await getToken({ template: "your-template-name" });
```

<Callout type="info" title="Token Format">
  Clerk provides JWT tokens that include the user's ID in the `sub` claim, which
  is exactly what Tambo needs for user identification. The token is
  automatically signed and verified by Clerk.
</Callout>
