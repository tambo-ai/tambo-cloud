# Run lint-staged
npx lint-staged

# Run type checking and build in web app if files changed in web app
if git diff --cached --name-only | grep -q "^apps/web/"; then
  echo "ðŸ” Running type check and build for web app..."
  
  # Clear Next.js cache if package.json or next.config.mjs changed
  if git diff --cached --name-only | grep -q "apps/web/\(package.json\|next.config.mjs\)"; then
    echo "ðŸ“¦ Detected changes in package.json or next.config.mjs, clearing Next.js cache..."
    cd apps/web && rm -rf .next/cache
  fi
  
  # Run type check and build with timeout
  cd apps/web
  
  echo "ðŸ” Running type check..."
  if ! timeout 2m npm run check-types; then
    echo "âŒ Type check failed or took too long (>2 minutes)"
    exit 1
  fi
  
  echo "ðŸ—ï¸ Running build..."
  if ! timeout 5m npm run build; then
    echo "âŒ Build failed or took too long (>5 minutes)"
    exit 1
  fi
  
  echo "âœ… All checks passed!"
fi 